<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Folha de Controlo de Obra - Rel√≥gio</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Modals -->
    <div id="inactivityModal" class="modal">
        <div class="modal-content">
            <h2>‚ö†Ô∏è Inatividade Detectada</h2>
            <p>N√£o detect√°mos actividade h√° <strong id="inactivityTime">5 minutos</strong>.</p>
            <p>O timer foi <strong>pausado automaticamente</strong> para garantir precis√£o no registo de horas.</p>
            <div class="info-panel">
                <strong>Tempo pausado:</strong> <span id="pausedDuration">0m 0s</span>
            </div>
            <p style="font-size: 14px; color: #6c757d; margin-top: 15px;">Deseja retomar o trabalho?</p>
            <div class="modal-buttons">
                <button class="btn btn-success" onclick="resumeTimer()">‚úì Retomar</button>
                <button class="btn btn-danger" onclick="stopWorkFromInactivity()">‚úó Parar</button>
            </div>
        </div>
    </div>

    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h2 id="confirmTitle">Confirmar</h2>
            <div class="confirm-dialog">
                <p id="confirmMessage"></p>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-success" id="confirmYes">Sim</button>
                <button class="btn btn-secondary" id="confirmNo">N√£o</button>
            </div>
        </div>
    </div>

    <div id="alertModal" class="modal">
        <div class="modal-content">
            <h2 id="alertTitle">Aviso</h2>
            <div class="confirm-dialog">
                <p id="alertMessage"></p>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="alertOk">OK</button>
            </div>
        </div>
    </div>

    <div id="newProjectModal" class="modal">
        <div class="modal-content">
            <h2>üÜï Abrir Nova Obra</h2>
            <div id="newProjectError" class="error-message hidden"></div>
            <div id="newProjectSuccess" class="success-message hidden"></div>
            <div class="form-group">
                <label>C√≥digo da Obra *</label>
                <input type="text" id="newProjectCode" placeholder="Ex: 1234\5678 90 123 - 4567">
            </div>
            <div class="form-group">
                <label>Nome da Obra *</label>
                <input type="text" id="newProjectName" placeholder="Ex: Instala√ß√£o Sistema AVAC - Empresa XYZ">
            </div>
            <div class="form-group">
                <label>Observa√ß√µes (opcional)</label>
                <textarea id="newProjectNotes" placeholder="Informa√ß√µes adicionais sobre a obra..."></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-success" onclick="createNewProject()">‚úì Criar Obra</button>
                <button class="btn btn-secondary" onclick="closeNewProjectModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="reopenProjectModal" class="modal">
        <div class="modal-content">
            <h2>üîÑ Reabrir Obra</h2>
            <div id="reopenProjectError" class="error-message hidden"></div>
            <div class="info-panel" style="margin-bottom: 20px;">
                <div class="info-item">
                    <span class="label">C√≥digo:</span>
                    <span class="value" id="reopenProjectCode">-</span>
                </div>
                <div class="info-item">
                    <span class="label">Nome:</span>
                    <span class="value" id="reopenProjectName">-</span>
                </div>
            </div>
            <div class="form-group">
                <label>Motivo da Reabertura *</label>
                <select id="reopenReason">
                    <option value="">Selecione o motivo</option>
                    <option value="client_change">Altera√ß√£o do Cliente</option>
                    <option value="our_error">Erro Nosso</option>
                </select>
            </div>
            <div class="form-group">
                <label>Coment√°rio (opcional)</label>
                <textarea id="reopenComment" placeholder="Descreva o motivo da reabertura..."></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-warning" onclick="confirmReopenProject()">üîÑ Reabrir Obra</button>
                <button class="btn btn-secondary" onclick="closeReopenProjectModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="editModal" class="modal">
        <div class="modal-content">
            <h2>‚úèÔ∏è Editar Sess√£o</h2>
            <div id="editError" class="error-message hidden"></div>
            <div id="editSuccess" class="success-message hidden"></div>
            <div class="radio-group">
                <div class="radio-option">
                    <input type="radio" id="editWorkTypeProject" name="editWorkType" value="project" checked onchange="updateEditFields()">
                    <label for="editWorkTypeProject" class="radio-label">üè¢ Trabalho de Projeto</label>
                </div>
                <div class="radio-option internal">
                    <input type="radio" id="editWorkTypeInternal" name="editWorkType" value="internal" onchange="updateEditFields()">
                    <label for="editWorkTypeInternal" class="radio-label">üè† Trabalho Interno</label>
                </div>
            </div>
            <div id="editProjectFields">
                <div class="form-group">
                    <label>Selecione a Obra</label>
                    <select id="editProjectSelect" onchange="updateEditProjectInfo()">
                        <option value="">-- Selecione uma obra --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Departamento / Tipo de Projeto</label>
                    <select id="editProjectType" onchange="updateEditSubcategories()">
                        <option value="">Selecione o departamento</option>
                        <option value="projeto">Projeto</option>
                        <option value="eletrico">El√©trico</option>
                        <option value="desenvolvimento">Desenvolvimento</option>
                        <option value="orcamentacao">Or√ßamenta√ß√£o</option>
                    </select>
                </div>
                <div class="form-group" id="editSubcategoryGroup" style="display: none;">
                    <label>Subcategoria</label>
                    <select id="editSubcategory">
                        <option value="">Selecione a subcategoria</option>
                    </select>
                </div>
            </div>
            <div id="editInternalFields" class="hidden">
                <div class="form-group">
                    <label>Categoria de Trabalho Interno</label>
                    <select id="editInternalCategory" onchange="updateEditMeetingProjects()">
                        <option value="reuniao">Reuni√£o</option>
                        <option value="formacao">Forma√ß√£o</option>
                    </select>
                </div>
                <div class="form-group" id="editMeetingProjectsGroup" style="display: none;">
                    <label>Obras Relacionadas (opcional)</label>
                    <div id="editMeetingProjectsList" class="checkbox-group"></div>
                    <div class="projects-count" id="editMeetingProjectsCount">0 obras selecionadas</div>
                </div>
                <div class="form-group">
                    <label>Descri√ß√£o</label>
                    <input type="text" id="editInternalDescription" placeholder="Ex: Reuni√£o semanal de equipa">
                </div>
            </div>
            <div class="form-group">
                <label>Data e Hora In√≠cio</label>
                <input type="datetime-local" id="editStartTime">
            </div>
            <div class="form-group">
                <label>Data e Hora Fim</label>
                <input type="datetime-local" id="editEndTime">
            </div>
            <div class="form-group">
                <label>Coment√°rio (opcional)</label>
                <textarea id="editComment" placeholder="Adicione observa√ß√µes..."></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-success" onclick="saveEdit()">üíæ Guardar</button>
                <button class="btn btn-secondary" onclick="closeEditModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="manualEntryModal" class="modal">
        <div class="modal-content">
            <h2>‚ûï Adicionar Sess√£o Manual</h2>
            <div id="manualError" class="error-message hidden"></div>
            <div id="manualSuccess" class="success-message hidden"></div>
            <div class="radio-group">
                <div class="radio-option">
                    <input type="radio" id="manualWorkTypeProject" name="manualWorkType" value="project" checked onchange="updateManualFields()">
                    <label for="manualWorkTypeProject" class="radio-label">üè¢ Trabalho de Projeto</label>
                </div>
                <div class="radio-option internal">
                    <input type="radio" id="manualWorkTypeInternal" name="manualWorkType" value="internal" onchange="updateManualFields()">
                    <label for="manualWorkTypeInternal" class="radio-label">üè† Trabalho Interno</label>
                </div>
            </div>
            <div id="manualProjectFields">
                <div class="form-group">
                    <label>Selecione a Obra</label>
                    <select id="manualProjectSelect" onchange="updateManualProjectInfo()">
                        <option value="">-- Selecione uma obra --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Departamento / Tipo de Projeto</label>
                    <select id="manualProjectType" onchange="updateManualSubcategories()">
                        <option value="">Selecione o departamento</option>
                        <option value="projeto">Projeto</option>
                        <option value="eletrico">El√©trico</option>
                        <option value="desenvolvimento">Desenvolvimento</option>
                        <option value="orcamentacao">Or√ßamenta√ß√£o</option>
                    </select>
                </div>
                <div class="form-group" id="manualSubcategoryGroup" style="display: none;">
                    <label>Subcategoria</label>
                    <select id="manualSubcategory">
                        <option value="">Selecione a subcategoria</option>
                    </select>
                </div>
            </div>
            <div id="manualInternalFields" class="hidden">
                <div class="form-group">
                    <label>Categoria de Trabalho Interno</label>
                    <select id="manualInternalCategory" onchange="updateManualMeetingProjects()">
                        <option value="reuniao">Reuni√£o</option>
                        <option value="formacao">Forma√ß√£o</option>
                    </select>
                </div>
                <div class="form-group" id="manualMeetingProjectsGroup" style="display: none;">
                    <label>Obras Relacionadas (opcional)</label>
                    <div id="manualMeetingProjectsList" class="checkbox-group"></div>
                    <div class="projects-count" id="manualMeetingProjectsCount">0 obras selecionadas</div>
                </div>
                <div class="form-group">
                    <label>Descri√ß√£o</label>
                    <input type="text" id="manualInternalDescription" placeholder="Ex: Reuni√£o semanal de equipa">
                </div>
            </div>
            <div class="form-group">
                <label>Data e Hora In√≠cio</label>
                <input type="datetime-local" id="manualStartTime">
            </div>
            <div class="form-group">
                <label>Data e Hora Fim</label>
                <input type="datetime-local" id="manualEndTime">
            </div>
            <div class="form-group">
                <label>Coment√°rio (opcional)</label>
                <textarea id="manualComment" placeholder="Adicione observa√ß√µes..."></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-success" onclick="saveManualEntry()">üíæ Adicionar</button>
                <button class="btn btn-secondary" onclick="closeManualEntryModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="commentsModal" class="modal">
        <div class="modal-content">
            <h2>üí¨ Coment√°rios</h2>
            <div id="commentError" class="error-message hidden"></div>
            <div id="commentSuccess" class="success-message hidden"></div>
            <div class="info-panel" style="margin-bottom: 15px;">
                <div class="info-item">
                    <span class="label">Projeto:</span>
                    <span class="value" id="commentProject">-</span>
                </div>
                <div class="info-item">
                    <span class="label">C√≥digo:</span>
                    <span class="value" id="commentWorkCode">-</span>
                </div>
            </div>
            <div class="comment-list" id="commentsList"></div>
            <div class="form-group">
                <label>Novo Coment√°rio</label>
                <textarea id="newComment" placeholder="Escreva seu coment√°rio..."></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="addComment()">‚ûï Adicionar</button>
                <button class="btn btn-secondary" onclick="closeCommentsModal()">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Floating Timer -->
    <div id="floatingTimer" class="floating-timer hidden">
        <div class="float-time">00:00:00</div>
        <div class="float-status">Parado</div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <div class="header" id="mainHeader">
            <h1>‚è±Ô∏è Controlo de Obra</h1>
            <p>Sistema de Gest√£o de Horas de Trabalho</p>
            <div id="adminBadge" class="admin-badge hidden">üõ°Ô∏è ADMINISTRADOR</div>
        </div>

        <!-- Login Screen -->
        <div id="loginScreen" class="content">
            <div id="loginError" class="error-message hidden"></div>
            <div class="form-group">
                <label for="loginUsername">Utilizador</label>
                <input type="text" id="loginUsername" placeholder="Nome de utilizador" onkeypress="if(event.key==='Enter')login()">
            </div>
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" placeholder="Password" onkeypress="if(event.key==='Enter')login()">
            </div>
            <button class="btn btn-primary" onclick="login()">Entrar</button>
            <button class="link-btn" onclick="showRegister()">Criar nova conta</button>
        </div>

        <!-- Register Screen -->
        <div id="registerScreen" class="content hidden">
            <div id="registerError" class="error-message hidden"></div>
            <div id="registerSuccess" class="success-message hidden"></div>
            <div class="form-group">
                <label for="regFirstName">Primeiro Nome</label>
                <input type="text" id="regFirstName" placeholder="Primeiro nome" onkeypress="if(event.key==='Enter')register()">
            </div>
            <div class="form-group">
                <label for="regLastName">√öltimo Nome</label>
                <input type="text" id="regLastName" placeholder="√öltimo nome" onkeypress="if(event.key==='Enter')register()">
            </div>
            <div class="form-group">
                <label for="regDepartment">Departamento Padr√£o</label>
                <select id="regDepartment">
                    <option value="">Selecione seu departamento</option>
                    <option value="projeto">Projeto</option>
                    <option value="eletrico">El√©trico</option>
                    <option value="desenvolvimento">Desenvolvimento</option>
                    <option value="orcamentacao">Or√ßamenta√ß√£o</option>
                </select>
            </div>
            <div class="form-group">
                <label for="regUsername">Nome de Utilizador</label>
                <input type="text" id="regUsername" placeholder="M√≠nimo 3 caracteres" onkeypress="if(event.key==='Enter')register()">
            </div>
            <div class="form-group">
                <label for="regPassword">Password</label>
                <input type="password" id="regPassword" placeholder="M√≠nimo 6 caracteres" onkeypress="if(event.key==='Enter')register()">
            </div>
            <button class="btn btn-success" onclick="register()">Registar</button>
            <button class="link-btn" onclick="showLogin()">J√° tenho conta</button>
        </div>

        <!-- App Screen -->
        <div id="appScreen" class="content hidden">
            <div class="tabs" id="mainTabs">
                <button class="tab active" onclick="showTab(event, 'timer')">‚è±Ô∏è Timer</button>
                <button class="tab" onclick="showTab(event, 'projects')">üìÅ Obras</button>
                <button class="tab" onclick="showTab(event, 'comments')">üí¨ Coment√°rios</button>
                <button class="tab" onclick="showTab(event, 'reports')">üìä Relat√≥rios</button>
                <button class="tab" onclick="showTab(event, 'export')">üíæ Exportar</button>
                <button class="tab" onclick="showTab(event, 'profile')">‚öôÔ∏è Perfil</button>
                <button class="tab admin-tab hidden" onclick="showTab(event, 'users')">üë• Utilizadores</button>
                <button class="tab admin-tab hidden" onclick="showTab(event, 'globalHistory')">üåê Hist√≥rico Global</button>
                <button class="tab admin-tab hidden" onclick="showTab(event, 'companyStats')">üìà Estat√≠sticas</button>
            </div>

            <!-- Timer Tab -->
            <div id="timerTab" class="tab-content active">
                <div class="timer-display">
                    <div class="time" id="currentTime">00:00:00</div>
                    <div class="date" id="currentDate">Data</div>
                </div>
                <div class="info-panel">
                    <div class="info-item">
                        <span class="label">Utilizador:</span>
                        <span class="value" id="userName">-</span>
                    </div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="workTypeProject" name="workType" value="project" checked onchange="updateWorkTypeFields()">
                        <label for="workTypeProject" class="radio-label">üè¢ Trabalho de Projeto</label>
                    </div>
                    <div class="radio-option internal">
                        <input type="radio" id="workTypeInternal" name="workType" value="internal" onchange="updateWorkTypeFields()">
                        <label for="workTypeInternal" class="radio-label">üè† Trabalho Interno</label>
                    </div>
                </div>
                <div id="projectFields">
                    <div class="form-group">
                        <label for="projectSelect">Selecionar Obra</label>
                        <select id="projectSelect" onchange="updateProjectInfo()">
                            <option value="">-- Selecione uma obra aberta --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="projectType">Departamento / Tipo de Projeto</label>
                        <select id="projectType" onchange="updateSubcategories()">
                            <option value="">Selecione o departamento</option>
                            <option value="projeto">Projeto</option>
                            <option value="eletrico">El√©trico</option>
                            <option value="desenvolvimento">Desenvolvimento</option>
                            <option value="orcamentacao">Or√ßamenta√ß√£o</option>
                        </select>
                    </div>
                    <div class="form-group" id="subcategoryGroup" style="display: none;">
                        <label for="subcategory">Subcategoria</label>
                        <select id="subcategory">
                            <option value="">Selecione a subcategoria</option>
                        </select>
                    </div>
                </div>
                <div id="internalFields" class="hidden">
                    <div class="form-group">
                        <label for="internalCategory">Categoria de Trabalho Interno</label>
                        <select id="internalCategory" onchange="updateMeetingProjects()">
                            <option value="reuniao">Reuni√£o</option>
                            <option value="formacao">Forma√ß√£o</option>
                        </select>
                    </div>
                    <div class="form-group" id="meetingProjectsGroup" style="display: none;">
                        <label>Obras Relacionadas (opcional)</label>
                        <div id="meetingProjectsList" class="checkbox-group"></div>
                        <div class="projects-count" id="meetingProjectsCount">0 obras selecionadas</div>
                    </div>
                    <div class="form-group">
                        <label for="internalDescription">Descri√ß√£o</label>
                        <input type="text" id="internalDescription" placeholder="Ex: Reuni√£o semanal de equipa">
                    </div>
                </div>
                <div id="timerError" class="error-message hidden"></div>
                <div class="work-timer" id="workTimerDisplay">
                    <div class="status" id="timerStatus">Parado</div>
                    <div class="timer" id="workTimer">00:00:00</div>
                    <div class="timer-controls">
                        <button class="btn btn-success" id="startBtn" onclick="startWork()">Iniciar</button>
                        <button class="btn btn-danger hidden" id="stopBtn" onclick="stopWork()">Parar</button>
                    </div>
                </div>
                <button class="btn btn-warning btn-manual-add" onclick="openManualEntry()">‚ûï Adicionar Sess√£o Manual</button>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="todayProjectHours">0h</div>
                        <div class="stat-label">Horas Projeto Hoje</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="todayInternalHours">0h</div>
                        <div class="stat-label">Horas Interno Hoje</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Hist√≥rico Recente</label>
                    <div id="workHistory" class="work-history"></div>
                </div>
            </div>

            <!-- Projects Tab -->
            <div id="projectsTab" class="tab-content">
                <h3 style="margin-bottom: 20px;">üìÅ Gest√£o de Obras</h3>
                <button class="btn btn-success" onclick="openNewProjectModal()" style="margin-bottom: 20px;">üÜï Abrir Nova Obra</button>
                <div class="filter-section">
                    <label>Filtrar Obras</label>
                    <select id="projectStatusFilter" onchange="loadProjectsList()">
                        <option value="open">Obras Abertas</option>
                        <option value="closed">Obras Fechadas</option>
                        <option value="all">Todas as Obras</option>
                    </select>
                </div>
                <div id="projectsList" class="projects-list"></div>
            </div>

            <!-- Comments Tab -->
            <div id="commentsTab" class="tab-content">
                <h3 style="margin-bottom: 20px;">üí¨ Coment√°rios por Obra</h3>
                <div class="info-panel" style="margin-bottom: 20px;">
                    <p style="color: #6c757d; font-size: 14px; line-height: 1.6;">Consulte e adicione coment√°rios √†s obras. Os coment√°rios ficam associados ao c√≥digo da obra.</p>
                </div>
                <div class="form-group">
                    <label>Selecione uma Obra</label>
                    <select id="selectWorkForComments" onchange="loadCommentsForWork()">
                        <option value="">-- Selecione --</option>
                    </select>
                </div>
                <div id="commentsDisplay" class="hidden">
                    <div class="comment-section">
                        <h4 style="margin-bottom: 10px;">Coment√°rios:</h4>
                        <div class="comment-list" id="workCommentsList"></div>
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Adicionar Coment√°rio</label>
                            <textarea id="quickComment" placeholder="Escreva seu coment√°rio..."></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="addQuickComment()">‚ûï Adicionar</button>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reportsTab" class="tab-content">
                <div class="filter-section">
                    <label>Filtrar por Tipo</label>
                    <select id="reportTypeFilter" onchange="updateReports()">
                        <option value="all">Todos os Trabalhos</option>
                        <option value="project">Trabalho de Projeto</option>
                        <option value="internal">Trabalho Interno</option>
                    </select>
                </div>
                <div class="filter-section" id="departmentFilterSection">
                    <label>Filtrar por Departamento</label>
                    <select id="reportFilter" onchange="updateReports()">
                        <option value="all">Todos os Departamentos</option>
                        <option value="projeto">Projeto</option>
                        <option value="eletrico">El√©trico</option>
                        <option value="desenvolvimento">Desenvolvimento</option>
                        <option value="orcamentacao">Or√ßamenta√ß√£o</option>
                    </select>
                </div>
                <div class="filter-section hidden" id="internalCategoryFilterSection">
                    <label>Filtrar por Categoria Interna</label>
                    <select id="internalCategoryFilter" onchange="updateReports()">
                        <option value="all">Todas as Categorias</option>
                        <option value="reuniao">Reuni√£o</option>
                        <option value="formacao">Forma√ß√£o</option>
                    </select>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalProjectHours">0h</div>
                        <div class="stat-label">Total Horas Projeto</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalInternalHours">0h</div>
                        <div class="stat-label">Total Horas Interno</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Todas as Sess√µes</label>
                    <div id="fullHistory" class="work-history"></div>
                </div>
            </div>

            <!-- Export Tab -->
            <div id="exportTab" class="tab-content">
                <h3 style="margin-bottom: 20px;">Exportar Dados</h3>
                <div class="info-panel" style="margin-bottom: 20px;">
                    <p style="color: #6c757d; font-size: 14px; line-height: 1.6;">Exporte os seus dados de controlo de horas para integra√ß√£o com sistemas PHC ou backup pessoal.</p>
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="exportCSV()">üìÑ Exportar CSV</button>
                    <button class="btn btn-primary" onclick="exportJSON()">üìã Exportar JSON</button>
                </div>
                <h3 style="margin: 30px 0 20px 0;">Backup e Restauro</h3>
                <div class="button-group">
                    <button class="btn btn-warning" onclick="backupData()">üíæ Backup Completo</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('restoreFile').click()">üì• Restaurar</button>
                </div>
                <input type="file" id="restoreFile" accept=".json" style="display: none;" onchange="restoreData(this)">
                <div class="info-panel" style="margin-top: 20px;">
                    <div class="info-item">
                        <span class="label">Total de Sess√µes:</span>
                        <span class="value" id="exportSessionCount">0</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Obras Registadas:</span>
                        <span class="value" id="exportProjectCount">0</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Utilizadores Registados:</span>
                        <span class="value" id="exportUserCount">0</span>
                    </div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="profileTab" class="tab-content">
                <h3 style="margin-bottom: 20px;">‚öôÔ∏è Perfil de Utilizador</h3>
                <div class="info-panel" style="margin-bottom: 20px;">
                    <p style="color: #6c757d; font-size: 14px; line-height: 1.6;">Visualize e edite as suas informa√ß√µes pessoais e credenciais de acesso.</p>
                </div>
                
                <div id="profileError" class="error-message hidden"></div>
                <div id="profileSuccess" class="success-message hidden"></div>
                
                <h4 style="margin: 20px 0 15px 0;">üìã Informa√ß√µes Pessoais</h4>
                <div class="form-group">
                    <label for="profileFirstName">Primeiro Nome</label>
                    <input type="text" id="profileFirstName" placeholder="Primeiro nome">
                </div>
                <div class="form-group">
                    <label for="profileLastName">√öltimo Nome</label>
                    <input type="text" id="profileLastName" placeholder="√öltimo nome">
                </div>
                <div class="form-group">
                    <label for="profileDepartment">Departamento Padr√£o</label>
                    <select id="profileDepartment">
                        <option value="">Selecione o departamento</option>
                        <option value="projeto">Projeto</option>
                        <option value="eletrico">El√©trico</option>
                        <option value="desenvolvimento">Desenvolvimento</option>
                        <option value="orcamentacao">Or√ßamenta√ß√£o</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="updatePersonalInfo()">üíæ Guardar Informa√ß√µes</button>
                
                <h4 style="margin: 30px 0 15px 0;">üîê Credenciais de Acesso</h4>
                <div class="form-group">
                    <label for="profileUsername">Nome de Utilizador</label>
                    <input type="text" id="profileUsername" placeholder="Nome de utilizador (m√≠nimo 3 caracteres)">
                </div>
                <button class="btn btn-warning" onclick="updateUsername()">‚úèÔ∏è Alterar Username</button>
                
                <h4 style="margin: 30px 0 15px 0;">üîë Alterar Password</h4>
                <div class="form-group">
                    <label for="profileOldPassword">Password Atual</label>
                    <input type="password" id="profileOldPassword" placeholder="Password atual">
                </div>
                <div class="form-group">
                    <label for="profileNewPassword">Nova Password</label>
                    <input type="password" id="profileNewPassword" placeholder="Nova password (m√≠nimo 6 caracteres)">
                </div>
                <div class="form-group">
                    <label for="profileConfirmPassword">Confirmar Nova Password</label>
                    <input type="password" id="profileConfirmPassword" placeholder="Confirme a nova password">
                </div>
                <button class="btn btn-success" onclick="updatePassword()">üîí Alterar Password</button>
                
                <div class="info-panel" style="margin-top: 30px;">
                    <div class="info-item">
                        <span class="label">Tipo de Conta:</span>
                        <span class="value" id="profileAccountType">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Membro desde:</span>
                        <span class="value">Utilizador existente</span>
                    </div>
                </div>
            </div>

            <!-- ADMIN: Users Tab -->
            <div id="usersTab-content" class="tab-content">
                <h3 style="margin-bottom: 20px;">üë• Gest√£o de Utilizadores</h3>
                <div class="info-panel" style="margin-bottom: 20px;">
                    <p style="color: #6c757d; font-size: 14px; line-height: 1.6;">Visualize e gerencie todos os utilizadores do sistema. Pode promover utilizadores a administrador ou remover privil√©gios administrativos.</p>
                </div>
                <div id="usersList" class="users-list"></div>
            </div>

            <!-- ADMIN: Global History Tab -->
            <div id="globalHistoryTab-content" class="tab-content">
                <h3 style="margin-bottom: 20px;">üåê Hist√≥rico Global de Trabalho</h3>
                <div class="filter-section">
                    <label>Filtrar por Utilizador</label>
                    <select id="globalUserFilter" onchange="updateGlobalHistory()">
                        <option value="all">Todos os Utilizadores</option>
                    </select>
                </div>
                <div class="filter-section">
                    <label>Filtrar por Tipo</label>
                    <select id="globalTypeFilter" onchange="updateGlobalHistory()">
                        <option value="all">Todos os Trabalhos</option>
                        <option value="project">Trabalho de Projeto</option>
                        <option value="internal">Trabalho Interno</option>
                    </select>
                </div>
                <div class="filter-section" id="globalDepartmentFilterSection">
                    <label>Filtrar por Departamento</label>
                    <select id="globalDepartmentFilter" onchange="updateGlobalHistory()">
                        <option value="all">Todos os Departamentos</option>
                        <option value="projeto">Projeto</option>
                        <option value="eletrico">El√©trico</option>
                        <option value="desenvolvimento">Desenvolvimento</option>
                        <option value="orcamentacao">Or√ßamenta√ß√£o</option>
                    </select>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="globalTotalProjectHours">0h</div>
                        <div class="stat-label">Total Horas Projeto (Global)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="globalTotalInternalHours">0h</div>
                        <div class="stat-label">Total Horas Interno (Global)</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Hist√≥rico Global</label>
                    <div id="globalHistoryList" class="work-history"></div>
                </div>
            </div>

            <!-- ADMIN: Company Stats Tab -->
            <div id="companyStatsTab-content" class="tab-content">
                <h3 style="margin-bottom: 20px;">üìà Estat√≠sticas da Empresa</h3>
                <div class="info-panel" style="margin-bottom: 20px;">
                    <p style="color: #6c757d; font-size: 14px; line-height: 1.6;">Visualize estat√≠sticas agregadas de todos os utilizadores e departamentos.</p>
                </div>
                <h4 style="margin: 20px 0 10px 0;">üìä Resumo Geral</h4>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="companyTotalUsers">0</div>
                        <div class="stat-label">Total Utilizadores</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="companyTotalProjects">0</div>
                        <div class="stat-label">Total Obras</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="companyTotalSessions">0</div>
                        <div class="stat-label">Total Sess√µes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="companyTotalHours">0h</div>
                        <div class="stat-label">Total Horas Trabalhadas</div>
                    </div>
                </div>
                <h4 style="margin: 30px 0 10px 0;">üè¢ Por Departamento</h4>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="deptProjetoHours">0h</div>
                        <div class="stat-label">Projeto</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="deptEletricoHours">0h</div>
                        <div class="stat-label">El√©trico</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="deptDesenvolvimentoHours">0h</div>
                        <div class="stat-label">Desenvolvimento</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="deptOrcamentacaoHours">0h</div>
                        <div class="stat-label">Or√ßamenta√ß√£o</div>
                    </div>
                </div>
                <h4 style="margin: 30px 0 10px 0;">üè† Trabalho Interno</h4>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="internalReuniaoHours">0h</div>
                        <div class="stat-label">Reuni√µes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="internalFormacaoHours">0h</div>
                        <div class="stat-label">Forma√ß√µes</div>
                    </div>
                </div>
                <h4 style="margin: 30px 0 10px 0;">üë• Por Utilizador</h4>
                <div id="userStatsBreakdown" class="work-history"></div>
            </div>

            <button class="btn btn-secondary" onclick="logout()" style="margin-top: 20px;">Sair</button>
        </div>
    </div>

    <script src="admin.js"></script>
    <script src="app.js"></script>
</body>
</html>