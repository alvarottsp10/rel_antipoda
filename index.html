<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Folha de Controlo de Obra - Rel√≥gio</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="inactivityModal" class="modal">
        <div class="modal-content">
            <h2>‚ö†Ô∏è Inatividade Detectada</h2>
            <p>N√£o detect√°mos actividade h√° <strong id="inactivityTime">5 minutos</strong>.</p>
            <p>O timer foi <strong>pausado automaticamente</strong> para garantir precis√£o no registo de horas.</p>
            <div class="info-panel">
                <strong>Tempo pausado:</strong> <span id="pausedDuration">0m 0s</span>
            </div>
            <p style="font-size: 14px; color: #6c757d; margin-top: 15px;">Deseja retomar o trabalho?</p>
            <div class="modal-buttons">
                <button class="btn btn-success" onclick="resumeTimer()">‚úì Retomar</button>
                <button class="btn btn-danger" onclick="stopWorkFromInactivity()">‚úó Parar</button>
            </div>
        </div>
    </div>

    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h2 id="confirmTitle">Confirmar</h2>
            <div class="confirm-dialog">
                <p id="confirmMessage"></p>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-success" id="confirmYes">Sim</button>
                <button class="btn btn-secondary" id="confirmNo">N√£o</button>
            </div>
        </div>
    </div>

    <div id="alertModal" class="modal">
        <div class="modal-content">
            <h2 id="alertTitle">Aviso</h2>
            <div class="confirm-dialog">
                <p id="alertMessage"></p>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="alertOk">OK</button>
            </div>
        </div>
    </div>

    <div id="newProjectModal" class="modal">
        <div class="modal-content">
            <h2>üÜï Abrir Nova Obra</h2>
            <div id="newProjectError" class="error-message hidden"></div>
            <div id="newProjectSuccess" class="success-message hidden"></div>
            <div class="form-group">
                <label>C√≥digo da Obra *</label>
                <input type="text" id="newProjectCode" placeholder="Ex: 1234\5678 90 123 - 4567">
            </div>
            <div class="form-group">
                <label>Nome da Obra *</label>
                <input type="text" id="newProjectName" placeholder="Ex: Instala√ß√£o Sistema AVAC - Empresa XYZ">
            </div>
            <div class="form-group">
                <label>Observa√ß√µes (opcional)</label>
                <textarea id="newProjectNotes" placeholder="Informa√ß√µes adicionais sobre a obra..."></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-success" onclick="createNewProject()">‚úì Criar Obra</button>
                <button class="btn btn-secondary" onclick="closeNewProjectModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="reopenProjectModal" class="modal">
        <div class="modal-content">
            <h2>üîÑ Reabrir Obra</h2>
            <div id="reopenProjectError" class="error-message hidden"></div>
            <div class="info-panel" style="margin-bottom: 20px;">
                <div class="info-item">
                    <span class="label">C√≥digo:</span>
                    <span class="value" id="reopenProjectCode">-</span>
                </div>
                <div class="info-item">
                    <span class="label">Nome:</span>
                    <span class="value" id="reopenProjectName">-</span>
                </div>
            </div>
            <div class="form-group">
                <label>Motivo da Reabertura *</label>
                <select id="reopenReason">
                    <option value="">Selecione o motivo</option>
                    <option value="client_change">Altera√ß√£o do Cliente</option>
                    <option value="our_error">Erro Nosso</option>
                </select>
            </div>
            <div class="form-group">
                <label>Coment√°rio (opcional)</label>
                <textarea id="reopenComment" placeholder="Descreva o motivo da reabertura..."></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-warning" onclick="confirmReopenProject()">üîÑ Reabrir Obra</button>
                <button class="btn btn-secondary" onclick="closeReopenProjectModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="editModal" class="modal">
        <div class="modal-content">
            <h2>‚úèÔ∏è Editar Sess√£o</h2>
            <div id="editError" class="error-message hidden"></div>
            <div id="editSuccess" class="success-message hidden"></div>
            <div class="radio-group">
                <div class="radio-option">
                    <input type="radio" id="editWorkTypeProject" name="editWorkType" value="project" checked onchange="updateEditFields()">
                    <label for="editWorkTypeProject" class="radio-label">üè¢ Trabalho de Projeto</label>
                </div>
                <div class="radio-option internal">
                    <input type="radio" id="editWorkTypeInternal" name="editWorkType" value="internal" onchange="updateEditFields()">
                    <label for="editWorkTypeInternal" class="radio-label">üè† Trabalho Interno</label>
                </div>
            </div>
            <div id="editProjectFields">
                <div class="form-group">
                    <label>Selecione a Obra</label>
                    <select id="editProjectSelect" onchange="updateEditProjectInfo()">
                        <option value="">-- Selecione uma obra --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Departamento / Tipo de Projeto</label>
                    <select id="editProjectType" onchange="updateEditSubcategories()">
                        <option value="">Selecione o departamento</option>
                        <option value="projeto">Projeto</option>
                        <option value="eletrico">El√©trico</option>
                        <option value="desenvolvimento">Desenvolvimento</option>
                        <option value="orcamentacao">Or√ßamenta√ß√£o</option>
                    </select>
                </div>
                <div class="form-group" id="editSubcategoryGroup" style="display: none;">
                    <label>Subcategoria</label>
                    <select id="editSubcategory">
                        <option value="">Selecione a subcategoria</option>
                    </select>
                </div>
            </div>
            <div id="editInternalFields" class="hidden">
                <div class="form-group">
                    <label>Categoria de Trabalho Interno</label>
                    <select id="editInternalCategory" onchange="updateEditMeetingProjects()">
                        <option value="reuniao">Reuni√£o</option>
                        <option value="formacao">Forma√ß√£o</option>
                    </select>
                </div>
                <div class="form-group" id="editMeetingProjectsGroup" style="display: none;">
                    <label>Obras Relacionadas (opcional)</label>
                    <div id="editMeetingProjectsList" class="checkbox-group"></div>
                    <div class="projects-count" id="editMeetingProjectsCount">0 obras selecionadas</div>
                </div>
                <div class="form-group">
                    <label>Descri√ß√£o</label>
                    <input type="text" id="editInternalDescription" placeholder="Ex: Reuni√£o semanal de equipa">
                </div>
            </div>
            <div class="form-group">
                <label>Data e Hora In√≠cio</label>
                <input type="datetime-local" id="editStartTime">
            </div>
            <div class="form-group">
                <label>Data e Hora Fim</label>
                <input type="datetime-local" id="editEndTime">
            </div>
            <div class="form-group">
                <label>Coment√°rio (opcional)</label>
                <textarea id="editComment" placeholder="Adicione observa√ß√µes..."></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-success" onclick="saveEdit()">üíæ Guardar</button>
                <button class="btn btn-secondary" onclick="closeEditModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="manualEntryModal" class="modal">
        <div class="modal-content">
            <h2>‚ûï Adicionar Sess√£o Manual</h2>
            <div id="manualError" class="error-message hidden"></div>
            <div id="manualSuccess" class="success-message hidden"></div>
            <div class="radio-group">
                <div class="radio-option">
                    <input type="radio" id="manualWorkTypeProject" name="manualWorkType" value="project" checked onchange="updateManualFields()">
                    <label for="manualWorkTypeProject" class="radio-label">üè¢ Trabalho de Projeto</label>
                </div>
                <div class="radio-option internal">
                    <input type="radio" id="manualWorkTypeInternal" name="manualWorkType" value="internal" onchange="updateManualFields()">
                    <label for="manualWorkTypeInternal" class="radio-label">üè† Trabalho Interno</label>
                </div>
            </div>
            <div id="manualProjectFields">
                <div class="form-group">
                    <label>Selecione a Obra</label>
                    <select id="manualProjectSelect" onchange="updateManualProjectInfo()">
                        <option value="">-- Selecione uma obra --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Departamento / Tipo de Projeto</label>
                    <select id="manualProjectType" onchange="updateManualSubcategories()">
                        <option value="">Selecione o departamento</option>
                        <option value="projeto">Projeto</option>
                        <option value="eletrico">El√©trico</option>
                        <option value="desenvolvimento">Desenvolvimento</option>
                        <option value="orcamentacao">Or√ßamenta√ß√£o</option>
                    </select>
                </div>
                <div class="form-group" id="manualSubcategoryGroup" style="display: none;">
                    <label>Subcategoria</label>
                    <select id="manualSubcategory">
                        <option value="">Selecione a subcategoria</option>
                    </select>
                </div>
            </div>
            <div id="manualInternalFields" class="hidden">
                <div class="form-group">
                    <label>Categoria de Trabalho Interno</label>
                    <select id="manualInternalCategory" onchange="updateManualMeetingProjects()">
                        <option value="reuniao">Reuni√£o</option>
                        <option value="formacao">Forma√ß√£o</option>
                    </select>
                </div>
                <div class="form-group" id="manualMeetingProjectsGroup" style="display: none;">
                    <label>Obras Relacionadas (opcional)</label>
                    <div id="manualMeetingProjectsList" class="checkbox-group"></div>
                    <div class="projects-count" id="manualMeetingProjectsCount">0 obras selecionadas</div>
                </div>
                <div class="form-group">
                    <label>Descri√ß√£o</label>
                    <input type="text" id="manualInternalDescription" placeholder="Ex: Reuni√£o semanal de equipa">
                </div>
            </div>
            <div class="form-group">
                <label>Data e Hora In√≠cio</label>
                <input type="datetime-local" id="manualStartTime">
            </div>
            <div class="form-group">
                <label>Data e Hora Fim</label>
                <input type="datetime-local" id="manualEndTime">
            </div>
            <div class="form-group">
                <label>Coment√°rio (opcional)</label>
                <textarea id="manualComment" placeholder="Adicione observa√ß√µes..."></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-success" onclick="saveManualEntry()">üíæ Adicionar</button>
                <button class="btn btn-secondary" onclick="closeManualEntryModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="commentsModal" class="modal">
        <div class="modal-content">
            <h2>üí¨ Coment√°rios</h2>
            <div id="commentError" class="error-message hidden"></div>
            <div id="commentSuccess" class="success-message hidden"></div>
            <div class="info-panel" style="margin-bottom: 15px;">
                <div class="info-item">
                    <span class="label">Projeto:</span>
                    <span class="value" id="commentProject">-</span>
                </div>
                <div class="info-item">
                    <span class="label">C√≥digo:</span>
                    <span class="value" id="commentWorkCode">-</span>
                </div>
            </div>
            <div class="comment-list" id="commentsList"></div>
            <div class="form-group">
                <label>Novo Coment√°rio</label>
                <textarea id="newComment" placeholder="Escreva seu coment√°rio..."></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="addComment()">‚ûï Adicionar</button>
                <button class="btn btn-secondary" onclick="closeCommentsModal()">Fechar</button>
            </div>
        </div>
    </div>


    <div id="dayModal" class="modal">
        <div class="modal-content">
            <h2 id="modalDayDate">Data</h2>
            <div id="modalDayContent"></div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeDayModal()">Fechar</button>
            </div>
        </div>
    </div>

    <div id="singleVacationModal" class="modal">
        <div class="modal-content">
            <h2>üèñÔ∏è Marcar F√©rias</h2>
            <input type="hidden" id="singleVacationDate">
            <div class="form-group">
                <label>Observa√ß√£o (opcional)</label>
                <textarea id="singleVacationNote" placeholder="Ex: F√©rias de Ver√£o, Ponte, etc..."></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-success" onclick="confirmSingleVacation()">‚úì Marcar</button>
                <button class="btn btn-secondary" onclick="closeSingleVacationModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="singleAbsenceModal" class="modal">
        <div class="modal-content">
            <h2>‚ùå Marcar Falta</h2>
            <div id="absenceError" class="error-message hidden"></div>
            <input type="hidden" id="singleAbsenceDate">
            <div class="form-group">
                <label>Motivo da Falta *</label>
                <textarea id="singleAbsenceNote" placeholder="Ex: Consulta m√©dica, Assunto pessoal, etc..."></textarea>
            </div>
            <div class="info-panel" style="margin-top: 15px;">
                <p style="font-size: 12px; color: #6c757d;">‚ÑπÔ∏è O motivo da falta √© obrigat√≥rio para registo.</p>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-danger" onclick="confirmSingleAbsence()">‚úì Marcar</button>
                <button class="btn btn-secondary" onclick="closeSingleAbsenceModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="vacationPeriodModal" class="modal">
        <div class="modal-content">
            <h2>üèñÔ∏è Marcar Per√≠odo de F√©rias</h2>
            <div class="form-group">
                <label>Data de In√≠cio</label>
                <input type="date" id="vacationStartDate" onchange="updateVacationDaysCount()">
            </div>
            <div class="form-group">
                <label>Data de Fim</label>
                <input type="date" id="vacationEndDate" onchange="updateVacationDaysCount()">
            </div>
            <div class="form-group">
                <label>Observa√ß√£o (opcional)</label>
                <textarea id="vacationPeriodNote" placeholder="Ex: F√©rias de Ver√£o"></textarea>
            </div>
            <div class="vacation-days-count">
                <span style="color: #2e7d32;">üìÖ</span>
                <strong id="vacationDaysCount">0 dias</strong>
                <div style="font-size: 11px; color: #6c757d; margin-top: 5px;">(apenas dias √∫teis, excluindo domingos e feriados)</div>
            </div>
            <div class="info-panel" style="margin-top: 15px;">
                <p style="font-size: 12px; color: #6c757d;">‚ÑπÔ∏è Apenas dias √∫teis ser√£o marcados. Domingos e feriados s√£o automaticamente exclu√≠dos.</p>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-success" onclick="confirmVacationPeriod()">‚úì Confirmar</button>
                <button class="btn btn-secondary" onclick="closeVacationPeriodModal()">Cancelar</button>
            </div>
        </div>
    </div>
    <div id="floatingTimer" class="floating-timer hidden">
        <div class="float-time">00:00:00</div>
        <div class="float-status">Parado</div>
    </div>

    <div class="container">
        <div class="header" id="mainHeader">
            <h1>‚è±Ô∏è Controlo de Obra</h1>
            <p>Sistema de Gest√£o de Horas de Trabalho</p>
            <div id="adminBadge" class="admin-badge hidden">üõ°Ô∏è ADMINISTRADOR</div>
        </div>

        <div id="loginScreen" class="content">
            <div id="loginError" class="error-message hidden"></div>
            <div class="form-group">
                <label for="loginUsername">Utilizador</label>
                <input type="text" id="loginUsername" placeholder="Nome de utilizador" onkeypress="if(event.key==='Enter')login()">
            </div>
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" placeholder="Password" onkeypress="if(event.key==='Enter')login()">
            </div>
            <button class="btn btn-primary" onclick="login()">Entrar</button>
            <button class="link-btn" onclick="showRegister()">Criar nova conta</button>
        </div>

        <div id="registerScreen" class="content hidden">
            <div id="registerError" class="error-message hidden"></div>
            <div id="registerSuccess" class="success-message hidden"></div>
            <div class="form-group">
                <label for="regFirstName">Primeiro Nome</label>
                <input type="text" id="regFirstName" placeholder="Primeiro nome" onkeypress="if(event.key==='Enter')register()">
            </div>
            <div class="form-group">
                <label for="regLastName">√öltimo Nome</label>
                <input type="text" id="regLastName" placeholder="√öltimo nome" onkeypress="if(event.key==='Enter')register()">
            </div>
            <div class="form-group">
                <label for="regDepartment">Departamento Padr√£o</label>
                <select id="regDepartment">
                    <option value="">Selecione seu departamento</option>
                    <option value="projeto">Projeto</option>
                    <option value="eletrico">El√©trico</option>
                    <option value="desenvolvimento">Desenvolvimento</option>
                    <option value="orcamentacao">Or√ßamenta√ß√£o</option>
                </select>
            </div>
            <div class="form-group">
                <label for="regUsername">Nome de Utilizador</label>
                <input type="text" id="regUsername" placeholder="M√≠nimo 3 caracteres" onkeypress="if(event.key==='Enter')register()">
            </div>
            <div class="form-group">
                <label for="regPassword">Password</label>
                <input type="password" id="regPassword" placeholder="M√≠nimo 6 caracteres" onkeypress="if(event.key==='Enter')register()">
            </div>
            <button class="btn btn-success" onclick="register()">Registar</button>
            <button class="link-btn" onclick="showLogin()">J√° tenho conta</button>
        </div>


        <div id="appScreen" class="content hidden">
            <div class="tabs" id="mainTabs">
                <button class="tab active" onclick="showTab(event, 'timer')">‚è±Ô∏è Timer</button>
                <button class="tab" onclick="showTab(event, 'projects')">üìÅ Obras</button>
                <button class="tab" onclick="showTab(event, 'comments')">üí¨ Coment√°rios</button>
                <button class="tab" onclick="showTab(event, 'calendar')">üìÖ Calend√°rio</button>
                <button class="tab" onclick="showTab(event, 'reports')">üìä Relat√≥rios</button>
                <button class="tab" onclick="showTab(event, 'export')">üíæ Exportar</button>
                <button class="tab" onclick="showTab(event, 'profile')">‚öôÔ∏è Perfil</button>
                <button class="tab admin-tab hidden" onclick="showTab(event, 'users')">üë• Utilizadores</button>
                <button class="tab admin-tab hidden" onclick="showTab(event, 'globalHistory')">üåê Hist√≥rico Global</button>
                <button class="tab admin-tab hidden" onclick="showTab(event, 'companyStats')">üìà Estat√≠sticas</button>
            </div>

            <div id="timerTab" class="tab-content active">
                <div class="timer-display">
                    <div class="time" id="currentTime">00:00:00</div>
                    <div class="date" id="currentDate">Data</div>
                </div>
                <div class="info-panel">
                    <div class="info-item">
                        <span class="label">Utilizador:</span>
                        <span class="value" id="userName">-</span>
                    </div>
                </div>
                <div class="hours-summary-panel">
                    <h4 style="margin: 0 0 15px 0;">‚è±Ô∏è Horas Trabalhadas</h4>
                    <div class="hours-cards">
                        <div class="hours-card">
                            <div class="hours-icon">üìÖ</div>
                            <div class="hours-info">
                                <div class="hours-label">Hoje</div>
                                <div class="hours-value" id="hoursTodayValue">0h 0m</div>
                            </div>
                        </div>
                        <div class="hours-card">
                            <div class="hours-icon">üìä</div>
                            <div class="hours-info">
                                <div class="hours-label">Esta Semana</div>
                                <div class="hours-value" id="hoursWeekValue">0h 0m</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="workTypeProject" name="workType" value="project" checked onchange="updateWorkTypeFields()">
                        <label for="workTypeProject" class="radio-label">üè¢ Trabalho de Projeto</label>
                    </div>
                    <div class="radio-option internal">
                        <input type="radio" id="workTypeInternal" name="workType" value="internal" onchange="updateWorkTypeFields()">
                        <label for="workTypeInternal" class="radio-label">üè† Trabalho Interno</label>
                    </div>
                </div>
                <div id="projectFields">
                    <div class="form-group">
                        <label for="projectSelect">Selecionar Obra</label>
                        <select id="projectSelect" onchange="updateProjectInfo()">
                            <option value="">-- Selecione uma obra aberta --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="projectType">Departamento / Tipo de Projeto</label>
                        <select id="projectType" onchange="updateSubcategories()">
                            <option value="">Selecione o departamento</option>
                            <option value="projeto">Projeto</option>
                            <option value="eletrico">El√©trico</option>
                            <option value="desenvolvimento">Desenvolvimento</option>
                            <option value="orcamentacao">Or√ßamenta√ß√£o</option>
                        </select>
                    </div>
                    <div class="form-group" id="subcategoryGroup" style="display: none;">
                        <label for="subcategory">Subcategoria</label>
                        <select id="subcategory">
                            <option value="">Selecione a subcategoria</option>
                        </select>
                    </div>
                </div>
                <div id="internalFields" class="hidden">
                    <div class="form-group">
                        <label for="internalCategory">Categoria de Trabalho Interno</label>
                        <select id="internalCategory" onchange="updateMeetingProjects()">
                            <option value="reuniao">Reuni√£o</option>
                            <option value="formacao">Forma√ß√£o</option>
                        </select>
                    </div>
                    <div class="form-group" id="meetingProjectsGroup" style="display: none;">
                        <label>Obras Relacionadas (opcional)</label>
                        <div id="meetingProjectsList" class="checkbox-group"></div>
                        <div class="projects-count" id="meetingProjectsCount">0 obras selecionadas</div>
                    </div>
                    <div class="form-group">
                        <label for="internalDescription">Descri√ß√£o</label>
                        <input type="text" id="internalDescription" placeholder="Ex: Reuni√£o semanal de equipa">
                    </div>
                </div>
                <div id="timerError" class="error-message hidden"></div>
                <div class="work-timer" id="workTimerDisplay">
                    <div class="status" id="timerStatus">Parado</div>
                    <div class="timer" id="workTimer">00:00:00</div>
                    <div class="timer-controls">
                        <button class="btn btn-success" id="startBtn" onclick="startWork()">Iniciar</button>
                        <button class="btn btn-danger hidden" id="stopBtn" onclick="stopWork()">Parar</button>
                    </div>
                </div>
                <button class="btn btn-warning btn-manual-add" onclick="openManualEntry()">‚ûï Adicionar Sess√£o Manual</button>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="todayProjectHours">0h</div>
                        <div class="stat-label">Horas Projeto Hoje</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="todayInternalHours">0h</div>
                        <div class="stat-label">Horas Interno Hoje</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Hist√≥rico Recente</label>
                    <div id="workHistory" class="work-history"></div>
                </div>
            </div>

            <div id="projectsTab" class="tab-content">
                <h3 style="margin-bottom: 20px;">üìÅ Gest√£o de Obras</h3>
                <button id="newProjectBtn" class="btn btn-success" onclick="openNewProjectModal()" style="margin-bottom: 20px;">üÜï Abrir Nova Obra</button>
                
                <div id="projectsStatsPanel" class="info-panel" style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; color: var(--primary-color);">üìä Estat√≠sticas R√°pidas</h4>
                    <div class="stats-grid" style="margin-top: 10px;">
                        <div style="text-align: center; padding: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: var(--success-color);" id="statsOpenProjects">0</div>
                            <div style="font-size: 11px; color: #6c757d;">Obras Abertas</div>
                        </div>
                        <div style="text-align: center; padding: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: var(--accent-color);" id="statsClosedProjects">0</div>
                            <div style="font-size: 11px; color: #6c757d;">Obras Fechadas</div>
                        </div>
                        <div style="text-align: center; padding: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: var(--warning-color);" id="statsClientReopens">0</div>
                            <div style="font-size: 11px; color: #6c757d;">Reaberturas (Cliente)</div>
                        </div>
                        <div style="text-align: center; padding: 10px;">
                            <div style="font-size: 24px; font-weight: bold; color: var(--accent-color);" id="statsErrorReopens">0</div>
                            <div style="font-size: 11px; color: #6c757d;">Reaberturas (Erro Nosso)</div>
                        </div>
                    </div>
                </div>
                
                <div class="filter-section">
                    <label>Filtrar Obras</label>
                    <select id="projectStatusFilter" onchange="loadProjectsList()">
                        <option value="open">Obras Abertas</option>
                        <option value="closed">Obras Fechadas</option>
                        <option value="all">Todas as Obras</option>
                    </select>
                </div>
                <div id="projectsList" class="projects-list"></div>
            </div>


            <div id="calendarTab" class="tab-content">
                <div class="annual-calendar-container">
                    <div class="calendar-year-header">
                        <div class="year-display" id="currentYearDisplay">2026</div>
                        <div class="year-navigation">
                            <button class="year-nav-btn" onclick="goToCurrentYear()">Hoje</button>
                            <button class="year-nav-btn" onclick="changeYear(1)">Seguinte ‚ñ∂</button>
                        </div>
                    </div>
                    
                    <div class="calendar-info-panel">
                        <p>
                            <strong>üìÖ Como funciona:</strong> 
                            Os dias trabalhados aparecem automaticamente a <strong style="color: #28a745;">verde</strong> baseados no seu hist√≥rico. 
                            <strong style="color: #2196F3;">Feriados nacionais</strong> üéâ est√£o marcados automaticamente. 
                            Clique em qualquer dia para marcar f√©rias <strong style="color: #ffc107;">üèñÔ∏è</strong> ou faltas <strong style="color: #dc3545;">‚ùå</strong>. 
                        </p>
                    </div>
                    
                    <button class="quick-mark-vacation" onclick="openVacationPeriodModal()">
                        <span style="font-size: 24px;">üèñÔ∏è</span>
                        <span>Marcar Per√≠odo de F√©rias</span>
                    </button>
                    
                    <div class="annual-stats">
                        <div class="annual-stat-card stat-worked">
                            <div class="stat-value" id="statWorkedDays">0</div>
                            <div class="stat-label">Dias Trabalhados</div>
                        </div>
                        <div class="annual-stat-card stat-vacation">
                            <div class="stat-value" id="statVacationDays">0</div>
                            <div class="stat-label">Dias de F√©rias</div>
                        </div>
                        <div class="annual-stat-card stat-absence">
                            <div class="stat-value" id="statAbsenceDays">0</div>
                            <div class="stat-label">Faltas</div>
                        </div>
                        <div class="annual-stat-card stat-holiday">
                            <div class="stat-value" id="statHolidayDays">0</div>
                            <div class="stat-label">Feriados</div>
                        </div>
                        <div class="annual-stat-card stat-weekend">
                            <div class="stat-value" id="statWeekendDays">0</div>
                            <div class="stat-label">Domingos</div>
                        </div>
                        <div class="annual-stat-card stat-remaining">
                            <div class="stat-value" id="statRemainingDays">0</div>
                            <div class="stat-label">Dias Restantes</div>
                        </div>
                    </div>
                    
                    <div class="annual-calendar-grid" id="annualCalendarGrid"></div>
                    
                    <div class="calendar-legend">
                        <div class="legend-item">
                            <div class="legend-icon worked">üíº</div>
                            <span>Dia Trabalhado</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-icon vacation">üèñÔ∏è</div>
                            <span>F√©rias</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-icon absence">‚ùå</div>
                            <span>Falta</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-icon holiday">üéâ</div>
                            <span>Feriado</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-icon weekend">üè†</div>
                            <span>Domingo</span>
                        </div>
                    </div>
                </div>
            </div>
            <div id="commentsTab" class="tab-content">
                <h3 style="margin-bottom: 20px;">üí¨ Coment√°rios por Obra</h3>
                <div class="info-panel" style="margin-bottom: 20px;">
                    <p style="color: #6c757d; font-size: 14px; line-height: 1.6;">Consulte e adicione coment√°rios √†s obras. Os coment√°rios ficam associados ao c√≥digo da obra.</p>
                </div>
                <div class="form-group">
                    <label>Selecione uma Obra</label>
                    <select id="selectWorkForComments" onchange="loadCommentsForWork()">
                        <option value="">-- Selecione --</option>
                    </select>
                </div>
                <div id="commentsDisplay" class="hidden">
                    <div class="comment-section">
                        <h4 style="margin-bottom: 10px;">Coment√°rios:</h4>
                        <div class="comment-list" id="workCommentsList"></div>
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Adicionar Coment√°rio</label>
                            <textarea id="quickComment" placeholder="Escreva seu coment√°rio..."></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="addQuickComment()">‚ûï Adicionar</button>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reportsTab" class="tab-content">
                <div class="filter-section">
                    <label>Filtrar por Tipo</label>
                    <select id="reportTypeFilter" onchange="updateReports()">
                        <option value="all">Todos os Trabalhos</option>
                        <option value="project">Trabalho de Projeto</option>
                        <option value="internal">Trabalho Interno</option>
                    </select>
                </div>
                <div class="filter-section" id="departmentFilterSection">
                    <label>Filtrar por Departamento</label>
                    <select id="reportFilter" onchange="updateReports()">
                        <option value="all">Todos os Departamentos</option>
                        <option value="projeto">Projeto</option>
                        <option value="eletrico">El√©trico</option>
                        <option value="desenvolvimento">Desenvolvimento</option>
                        <option value="orcamentacao">Or√ßamenta√ß√£o</option>
                    </select>
                </div>
                <div class="filter-section hidden" id="internalCategoryFilterSection">
                    <label>Filtrar por Categoria Interna</label>
                    <select id="internalCategoryFilter" onchange="updateReports()">
                        <option value="all">Todas as Categorias</option>
                        <option value="reuniao">Reuni√£o</option>
                        <option value="formacao">Forma√ß√£o</option>
                    </select>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalProjectHours">0h</div>
                        <div class="stat-label">Total Horas Projeto</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalInternalHours">0h</div>
                        <div class="stat-label">Total Horas Interno</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Todas as Sess√µes</label>
                    <div id="fullHistory" class="work-history"></div>
                </div>
            </div>

            <div id="exportTab" class="tab-content">
                <h3 style="margin-bottom: 20px;">Exportar Dados</h3>
                <div class="info-panel" style="margin-bottom: 20px;">
                    <p style="color: #6c757d; font-size: 14px; line-height: 1.6;">Exporte os seus dados de controlo de horas para integra√ß√£o com sistemas PHC ou backup pessoal.</p>
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="exportCSV()">üìÑ Exportar CSV</button>
                    <button class="btn btn-primary" onclick="exportJSON()">üìã Exportar JSON</button>
                </div>
                <h3 style="margin: 30px 0 20px 0;">Backup e Restauro</h3>
                <div class="button-group">
                    <button class="btn btn-warning" onclick="backupData()">üíæ Backup Completo</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('restoreFile').click()">üì• Restaurar</button>
                </div>
                <input type="file" id="restoreFile" accept=".json" style="display: none;" onchange="restoreData(this)">
                <div class="info-panel" style="margin-top: 20px;">
                    <div class="info-item">
                        <span class="label">Total de Sess√µes:</span>
                        <span class="value" id="exportSessionCount">0</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Obras Registadas:</span>
                        <span class="value" id="exportProjectCount">0</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Utilizadores Registados:</span>
                        <span class="value" id="exportUserCount">0</span>
                    </div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="profileTab" class="tab-content">
                <h3 style="margin-bottom: 20px;">‚öôÔ∏è Perfil de Utilizador</h3>
                <div class="info-panel" style="margin-bottom: 20px;">
                    <p style="color: #6c757d; font-size: 14px; line-height: 1.6;">Visualize e edite as suas informa√ß√µes pessoais e credenciais de acesso.</p>
                </div>
                
                <div id="profileError" class="error-message hidden"></div>
                <div id="profileSuccess" class="success-message hidden"></div>
                
                
                <h4 style="margin: 20px 0 15px 0;">üì∑ Foto de Perfil</h4>
                <div class="profile-photo-section">
                    <div class="profile-photo-container">
                        <img id="profilePhotoPreview" src="" alt="Foto de Perfil" class="profile-photo">
                        <div class="profile-photo-placeholder">
                            <span id="profileInitials">?</span>
                        </div>
                    </div>
                    <div class="profile-photo-actions">
                        <input type="file" id="profilePhotoInput" accept="image/*" style="display: none;" onchange="handleProfilePhotoChange(event)">
                        <button class="btn btn-primary" onclick="document.getElementById('profilePhotoInput').click()">üì∑ Escolher Foto</button>
                        <button class="btn btn-secondary" onclick="removeProfilePhoto()" id="removePhotoBtn" style="display: none;">üóëÔ∏è Remover Foto</button>
                    </div>
                </div>
                <h4 style="margin: 20px 0 15px 0;">üìã Informa√ß√µes Pessoais</h4>
                <div class="form-group">
                    <label for="profileFirstName">Primeiro Nome</label>
                    <input type="text" id="profileFirstName" placeholder="Primeiro nome">
                </div>
                <div class="form-group">
                    <label for="profileLastName">√öltimo Nome</label>
                    <input type="text" id="profileLastName" placeholder="√öltimo nome">
                </div>
                <div class="form-group">
                    <label for="profileDepartment">Departamento Padr√£o</label>
                    <select id="profileDepartment">
                        <option value="">Selecione o departamento</option>
                        <option value="projeto">Projeto</option>
                        <option value="eletrico">El√©trico</option>
                        <option value="desenvolvimento">Desenvolvimento</option>
                        <option value="orcamentacao">Or√ßamenta√ß√£o</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="updatePersonalInfo()">üíæ Guardar Informa√ß√µes</button>
                
                <h4 style="margin: 30px 0 15px 0;">üîê Credenciais de Acesso</h4>
                <div class="form-group">
                    <label for="profileUsername">Nome de Utilizador</label>
                    <input type="text" id="profileUsername" placeholder="Nome de utilizador (m√≠nimo 3 caracteres)">
                </div>
                <button class="btn btn-warning" onclick="updateUsername()">‚úèÔ∏è Alterar Username</button>
                
                <h4 style="margin: 30px 0 15px 0;">üîë Alterar Password</h4>
                <div class="form-group">
                    <label for="profileOldPassword">Password Atual</label>
                    <input type="password" id="profileOldPassword" placeholder="Password atual">
                </div>
                <div class="form-group">
                    <label for="profileNewPassword">Nova Password</label>
                    <input type="password" id="profileNewPassword" placeholder="Nova password (m√≠nimo 6 caracteres)">
                </div>
                <div class="form-group">
                    <label for="profileConfirmPassword">Confirmar Nova Password</label>
                    <input type="password" id="profileConfirmPassword" placeholder="Confirme a nova password">
                </div>
                <button class="btn btn-success" onclick="updatePassword()">üîí Alterar Password</button>
                
                <div class="info-panel" style="margin-top: 30px;">
                    <div class="info-item">
                        <span class="label">Tipo de Conta:</span>
                        <span class="value" id="profileAccountType">-</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Membro desde:</span>
                        <span class="value">Utilizador existente</span>
                    </div>
                </div>
            </div>

            <div id="usersTab-content" class="tab-content">
                <h3 style="margin-bottom: 20px;">üë• Gest√£o de Utilizadores</h3>
                <div class="info-panel" style="margin-bottom: 20px;">
                    <p style="color: #6c757d; font-size: 14px; line-height: 1.6;">Visualize e gerencie todos os utilizadores do sistema. Pode promover utilizadores a administrador ou remover privil√©gios administrativos.</p>
                </div>
                <div id="usersList" class="users-list"></div>
            </div>

            <div id="globalHistoryTab-content" class="tab-content">
                <h3 style="margin-bottom: 20px;">üåê Hist√≥rico Global de Trabalho</h3>
                <div class="filter-section">
                    <label>Filtrar por Utilizador</label>
                    <select id="globalUserFilter" onchange="updateGlobalHistory()">
                        <option value="all">Todos os Utilizadores</option>
                    </select>
                </div>
                <div class="filter-section">
                    <label>Filtrar por Tipo</label>
                    <select id="globalTypeFilter" onchange="updateGlobalHistory()">
                        <option value="all">Todos os Trabalhos</option>
                        <option value="project">Trabalho de Projeto</option>
                        <option value="internal">Trabalho Interno</option>
                    </select>
                </div>
                <div class="filter-section" id="globalDepartmentFilterSection">
                    <label>Filtrar por Departamento</label>
                    <select id="globalDepartmentFilter" onchange="updateGlobalHistory()">
                        <option value="all">Todos os Departamentos</option>
                        <option value="projeto">Projeto</option>
                        <option value="eletrico">El√©trico</option>
                        <option value="desenvolvimento">Desenvolvimento</option>
                        <option value="orcamentacao">Or√ßamenta√ß√£o</option>
                    </select>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="globalTotalProjectHours">0h</div>
                        <div class="stat-label">Total Horas Projeto (Global)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="globalTotalInternalHours">0h</div>
                        <div class="stat-label">Total Horas Interno (Global)</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Hist√≥rico Global</label>
                    <div id="globalHistoryList" class="work-history"></div>
                </div>
            </div>

            <div id="companyStatsTab-content" class="tab-content">
                <h3 style="margin-bottom: 20px;">üìà Estat√≠sticas da Empresa</h3>
                <div class="info-panel" style="margin-bottom: 20px;">
                    <p style="color: #6c757d; font-size: 14px; line-height: 1.6;">Visualize estat√≠sticas agregadas de todos os utilizadores e departamentos.</p>
                </div>
                <h4 style="margin: 20px 0 10px 0;">üìä Resumo Geral</h4>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="companyTotalUsers">0</div>
                        <div class="stat-label">Total Utilizadores</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="companyTotalProjects">0</div>
                        <div class="stat-label">Total Obras</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="companyTotalSessions">0</div>
                        <div class="stat-label">Total Sess√µes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="companyTotalHours">0h</div>
                        <div class="stat-label">Total Horas Trabalhadas</div>
                    </div>
                </div>
                <h4 style="margin: 30px 0 10px 0;">üè¢ Por Departamento</h4>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="deptProjetoHours">0h</div>
                        <div class="stat-label">Projeto</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="deptEletricoHours">0h</div>
                        <div class="stat-label">El√©trico</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="deptDesenvolvimentoHours">0h</div>
                        <div class="stat-label">Desenvolvimento</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="deptOrcamentacaoHours">0h</div>
                        <div class="stat-label">Or√ßamenta√ß√£o</div>
                    </div>
                </div>
                <h4 style="margin: 30px 0 10px 0;">üè† Trabalho Interno</h4>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="internalReuniaoHours">0h</div>
                        <div class="stat-label">Reuni√µes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="internalFormacaoHours">0h</div>
                        <div class="stat-label">Forma√ß√µes</div>
                    </div>
                </div>
                <h4 style="margin: 30px 0 10px 0;">üîÑ Reaberturas de Obras</h4>
                <div class="info-panel" style="margin-bottom: 20px;">
                    <p style="color: #6c757d; font-size: 14px; line-height: 1.6;">An√°lise dos motivos de reabertura de obras conclu√≠das.</p>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalReopens">0</div>
                        <div class="stat-label">Total de Reaberturas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="clientChangeReopens">0</div>
                        <div class="stat-label">Altera√ß√£o do Cliente</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="ourErrorReopens">0</div>
                        <div class="stat-label">Erro Nosso</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="reopenPercentage">0%</div>
                        <div class="stat-label">% de Obras Reabertas</div>
                    </div>
                </div>
                <h4 style="margin: 30px 0 10px 0;">üìã Detalhes de Reaberturas</h4>
                <div id="reopenDetailsBreakdown" class="work-history"></div>
                <h4 style="margin: 30px 0 10px 0;">üë• Por Utilizador</h4>
                <div id="userStatsBreakdown" class="work-history"></div>
            </div>

            <button class="btn btn-secondary" onclick="logout()" style="margin-top: 20px;">Sair</button>
        </div>
    </div>

    <script src="calendar-simple.js"></script>
    <script src="admin.js"></script>
    <script src="app.js"></script>
</body>
</html>